
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Synaps API and topology &mdash; synaps 2013.2.1-dev documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2013.2.1-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/jquery.tweet.js"></script>
    <link rel="top" title="synaps 2013.2.1-dev documentation" href="../../index.html" />
    <link rel="up" title="Operations Guide" href="../operatormanual.html" />
    <link rel="next" title="RabbitMQ" href="rabbitmq.guide.html" />
    <link rel="prev" title="Command line interface Guide" href="cli.guide.html" /> 
  </head>
  <body>
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="synaps-api-and-topology">
<h1>Synaps API and topology<a class="headerlink" href="#synaps-api-and-topology" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synaps-api">
<h2>Synaps API<a class="headerlink" href="#synaps-api" title="Permalink to this headline">¶</a></h2>
<p>To start, stop, restart and check status of API server.</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo service synaps-api start
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre>sudo service synaps-api stop
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre>sudo service synaps-api restart
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre>sudo service synaps-api status
</pre></div>
</div>
</div>
<div class="section" id="synaps-topology">
<h2>Synaps topology<a class="headerlink" href="#synaps-topology" title="Permalink to this headline">¶</a></h2>
<p>These operations can be done at nimbus node.</p>
<p>Starting topology</p>
<div class="highlight-bash"><div class="highlight"><pre>user@nimbus<span class="nv">$ </span>sudo /SW/storm/bin/storm jar /SW/storm/synaps-storm.jar SynapsTopology
user@nimbus<span class="nv">$ </span>sudo synaps-reload-metric
</pre></div>
</div>
<p>Stopping topology</p>
<div class="highlight-bash"><div class="highlight"><pre>user@nimbus<span class="nv">$ </span>sudo /SW/storm/bin/storm <span class="nb">kill </span>synaps00
</pre></div>
</div>
<p>Re-balancing topology</p>
<div class="highlight-bash"><div class="highlight"><pre>user@nimbus<span class="nv">$ </span>sudo /SW/storm/bin/storm rebalance synaps00
user@nimbus<span class="nv">$ </span>sudo synaps-reload-metric
</pre></div>
</div>
<p>List all topology</p>
<div class="highlight-bash"><div class="highlight"><pre>user@nimbus<span class="nv">$ </span>sudo /SW/storm/bin/storm list
</pre></div>
</div>
<p>Monitor topology status</p>
<div class="highlight-bash"><div class="highlight"><pre>user@nimbus<span class="nv">$ </span>lynx localhost:8080
</pre></div>
</div>
</div>
<div class="section" id="minor-upgrade-procedure">
<h2>Minor upgrade procedure<a class="headerlink" href="#minor-upgrade-procedure" title="Permalink to this headline">¶</a></h2>
<p>When database scheme and internal RPC message formats are not changed, it can
be upgrade in a procedure as below.</p>
<p>First, it is needed to upgrade synaps package. The procedure is not much
different with another python packages. Copy synaps-api build to all server or
python package repository of your cloud and install the synaps-api package
using pip or easy_install tool.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sudo pip install -U synaps-yyyy.xxxx.tar.gz
</pre></div>
</div>
<p>Then, restart API servers to apply the changes. If API servers are configured
active-active by load balancer, it can be upgraded side-by-side. For example,
remove API group 1 from load balancer, wait about 1 minute for all requests
are processed, and add them to load balancer again. And then restart their api
services. And then, do same procedure to other group.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># before stop the api service, remove apigroup1 from load balancer.</span>
<span class="c"># wait enough...</span>
user@apigroup1 <span class="nv">$ </span>sudo service synaps-api restart
<span class="c"># add apigroup1 and remove apigroup2 from load balancer</span>
<span class="c"># wait enough...</span>
user@apigroup2 <span class="nv">$ </span>sudo service synaps-api restart
</pre></div>
</div>
<p>To upgrade topology, copy topology jar file, kill old topology and submit new
topology to nimbus. When stopping the topology, it stops to consume messages
from queue and wait for 30 seconds to process all message not processed yet.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When starting the topology, it loads all active metric data from database
to memory. This operation costs a lot of CPU. So metric data processing can
be delayed.</p>
<p class="last">Therefore it doesn&#8217;t evaluates alarms to avoid false alarming at boot time.
After receiving three ack messages from all workers, it assumes that
system&#8217;s status becomes stable and starts to evaluate alarms.</p>
</div>
<div class="highlight-bash"><div class="highlight"><pre>user@nimbus<span class="nv">$ </span>sudo storm <span class="nb">kill </span>synaps00
<span class="c"># check if old topology is killed and disappears from list</span>
user@nimbus<span class="nv">$ </span>sudo watch storm list
<span class="c"># submit new topology</span>
user@nimbus<span class="nv">$ </span>sudo storm jar /SW/storm/synaps-storm.jar SynapsTopology
user@nimbus<span class="nv">$ </span>sudo synaps-reload-metric
</pre></div>
</div>
<p>After upgrade topology, it would be better to check the topology runs well with
<cite>storm list</cite> command. Result will be like below.</p>
<div class="highlight-none"><div class="highlight"><pre>0    [main] INFO  backtype.storm.thrift  - Connecting to Nimbus at localhost:6627
Topology_name        Status     Num_tasks  Num_workers  Uptime_secs
-------------------------------------------------------------------
synaps00             ACTIVE     76         6            7061
</pre></div>
</div>
</div>
<div class="section" id="logs">
<h2>Logs<a class="headerlink" href="#logs" title="Permalink to this headline">¶</a></h2>
<p>It generates large logs as it processes a lot of requests. So it is important
to have enough disk spaces for logs and monitor if the space is still enough.
The default log path is <cite>/var/log/synaps</cite>.</p>
<p>And if your workers in your topology are failing, check storm log files at
<cite>/var/log/storm</cite> also.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Synaps API and topology</a><ul>
<li><a class="reference internal" href="#synaps-api">Synaps API</a></li>
<li><a class="reference internal" href="#synaps-topology">Synaps topology</a></li>
<li><a class="reference internal" href="#minor-upgrade-procedure">Minor upgrade procedure</a></li>
<li><a class="reference internal" href="#logs">Logs</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="cli.guide.html"
                                  title="previous chapter">Command line interface Guide</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="rabbitmq.guide.html"
                                  title="next chapter">RabbitMQ</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/artifacts/ops/synaps.guide.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="rabbitmq.guide.html" title="RabbitMQ"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cli.guide.html" title="Command line interface Guide"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">synaps 2013.2.1-dev documentation</a> &raquo;</li>
          <li><a href="../operatormanual.html" accesskey="U">Operations Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012-present, Samsung SDS.
      Last updated on Fri Dec 6 13:25:31 2013, commit 208956d.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>