.. _configure.api:

Configuration Synaps Module
---------------------------

To configure Synaps, you'll need to make configuration directory. The default
path is "/etc/synaps". *Those configuration files should be identical across the 
web servers and storm nodes.*

.. code-block:: bash

   sudo mkdir /etc/synaps
   
And then, create or edit "synaps.conf" file. Following is an example.

.. code-block:: bash

   [DEFAULT]
   cassandra_server_list = cassandra1:9160,cassandra2:9160,cassandra3:9160
   cassandra_keyspace = synaps
   cassandra_replication_factor = 3
   # 30 days in seconds
   statistics_ttl = 2592000
   
   log_dir = /var/log/synaps/
   api_paste_config = /etc/synaps/api-paste.ini
   
   ### rabbit mq configuration
   rabbit_host = rabbitmq_host
   
   smtp_server = mail.product
   mail_sender = synaps@my.openstack
   notification_bind_addr = tcp://*:31110
   notification_server_addr = tcp://synapsnoti:31110

Next, you'll need to create "api-paste.ini" like below for setting up the WSGI 
pipeline. 

.. code-block:: bash
  
   ##############
   # CloudWatch #
   ##############
   
   [composite:cloudwatch]
   use = egg:Paste#urlmap
   /monitor: cloudwatch_api_v1
   
   [pipeline:cloudwatch_api_v1]
   pipeline = fault_wrap log_request no_auth monitor_request authorizer cloudwatch_executor
   #pipeline = fault_wrap log_request authenticate monitor_request authorizer cloudwatch_executor
   
   [filter:fault_wrap]
   paste.filter_factory = synaps.api.cloudwatch:FaultWrapper.factory
   
   [filter:log_request]
   paste.filter_factory = synaps.api.cloudwatch:RequestLogging.factory
   
   [filter:no_auth]
   paste.filter_factory = synaps.api.cloudwatch:NoAuth.factory
   
   [filter:authenticate]
   paste.filter_factory = synaps.api.cloudwatch:Authenticate.factory
   
   [filter:monitor_request]
   controller = synaps.api.cloudwatch.monitor.MonitorController
   paste.filter_factory = synaps.api.cloudwatch:Requestify.factory
   
   [filter:authorizer]
   paste.filter_factory = synaps.api.cloudwatch:Authorizer.factory
   
   [app:cloudwatch_executor]
   paste.app_factory = synaps.api.cloudwatch:Executor.factory

You need to make directory for log file. Default path is "/var/log/synaps".

.. code-block:: bash

   sudo mkdir /var/log/synaps

Running synaps-api
------------------

To run synaps-api

.. code-block:: bash

   sudo service synaps-api start
